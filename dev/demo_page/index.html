<!DOCTYPE html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet"
 href="https://fonts.googleapis.com/css?family=Roboto|Droid+Sans+Mono">
<link rel="stylesheet" href="../note_expander/note_expander.css">
<link rel="stylesheet" href="demo.css">

<script src="../cursor_maintainer.js"></script>
<script src="../note_expander/note_expander.js"></script>
<script src="demo.js"></script>

<title> Cursor maintenance demos </title>

</head>
<body>

<div id="wrapper">


<h1> Cursor-maintenance demos </h1>

<div class="notes">

<p> This page demonstrates three approaches to maintaining cursor position
in a text input field that formats its contents in real time. Whenever
the text is formatted, the cursor position must be reconsidered. The
goal of cursor maintenance is to place the cursor in a position that
minimizes user surprise.

<p> The problem of cursor maintenance is discussed in an
<a href="">article</a>. Source code is available in a <a
href="">repository</a>.

</div>



<h2> Meta approach </h2>

<div class="notes">

<p> In the meta approach, we reimplement a format by applying elementary
operations to a text-with-cursor object. The object moves the cursor in
a predictable manner for each elementary operation.

<p> Below we demonstrate the meta approach with two formats,
<em>commatize</em> and <em>trimify</em>.

<p> Commatize is defined for text consisting of digits and commas. Input
strings containing other characters are rejected by a validation function
that runs before the formatter. Commatize displays a non-negative integer
with commas separating groups of three digits.

<p> Trimify is applicable to any text. The input is not validated before
formatting. Trimify removes whitespace from the beginning of the text,
then condenses all other whitespace sequences to one space each.

</div>


<h3> commatize </h3>

<input id="commatizeInput" spellcheck="false">


<h3> trimify </h3>

<textarea id="trimifyInput" spellcheck="false" class="text"></textarea>



<h2> Retrospective approach </h2>

<div class="notes">

<p> In retrospective cursor maintenance, we calculate a new cursor
position by comparing the formatted text to the original text and cursor
position. We only consider the current instance of formatting. Thus,
there is no need to modify the formatter or even to know what it does
in general.

<p> You can define a format to be used in the following input field by
inserting a JavaScript function into the editable code area below. To
serve as a formatter, the function must take a string argument and return
a string.

<p> The retrospective scoring formula used here is called <em>balanced
frequencies</em>. It computes the ratios of individual character
frequencies to the left and right of the cursor in the original text,
then tries to achieve similar ratios in the formatted text using a
least-squares fit.

</div>


<h3> user-defined </h3>

<textarea id="retrospectiveInput" spellcheck="false" class="text"></textarea>

<textarea id="retrospectiveCode" spellcheck="false" class="code"></textarea>



<h2> Layer approach </h2>

<div class="notes">

<p> In the layer approach, we define one or more character classes for
a given format. These character classes, called layers, are ranked by
priority. For a given layer in a given text, we calculate the number of
layer characters to the left of each text position divided by the total
number of layer characters in the text.

<p> We want to find a position in the formatted text where the ratio
in the first layer is as close as possible to the ratio of the cursor
position in the first layer in the original text. If several positions
are equally close, we shrink the range of candidate positions and move
on to the next layer. If all layers are exhausted, we choose either the
leftmost or rightmost position in the final candidate range. The choice
of breaking ties toward left or right is part of the configuration for
a given format.

<p> As with the retrospective approach, you can define your own format
in the code area below. You can modify the layer definitions and the
tie-breaking direction in the fields between the input area and the code
area. Each layer definition is a JavaScript regular expression.

</div>


<h3> user-defined </h3>

<textarea id="layerInput" spellcheck="false" class="text"></textarea>

<div class="layerLabel">layers:</div>
<div id="testerBox"></div>

<div id="preferRightBox">
  tie-breaker:
  <input type="radio" name="preferRight" checked> left
  <input type="radio" name="preferRight"> right
</div>

<textarea id="layerCode" spellcheck="false" class="code"></textarea>



</div><!--end wrapper -->
</body>
</html>
